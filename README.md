# Claude Code Usage Widget

A minimal macOS desktop widget that shows your Claude Code usage as a GitHub-style contribution graph with real-time API rate limit bars.

![Widget Screenshot](screenshot.png)

## Features

- **Contribution grid** — 16-week heatmap of daily message activity (Mon-Fri), colored by intensity
- **Rate limit bars** — Two vertical bars showing your 5-hour and 7-day API utilization, filled from bottom
- **Live updates** — Stats refresh every 30s from local logs, API data every 60s
- **Hover tooltips** — Hover any cell to see the day, date, and message count. Hover a bar to see utilization % and time until reset
- **Today indicator** — Current day cell has a white border
- **Future days** — Remaining weekdays in the current week show as dimmed cells
- **Desktop overlay** — Floats above the desktop, draggable, persists position across launches
- **Menu bar icon** — Refresh data or quit from the menu bar

## Requirements

- macOS 14+ (Sonnet)
- Xcode 15+
- An active Claude Code installation (`~/.claude/` directory)

## Setup

### 1. Claude Code Stats Cache

The widget reads from `~/.claude/stats-cache.json`, which is generated by the [claude-code-stats](https://github.com/anthropics/claude-code) CLI. If you use Claude Code, this file already exists.

### 2. API Usage Data (Optional)

For the rate limit bars, the widget reads your API key from `~/.claude/settings.json` to fetch usage data from the Anthropic API. Without this, the bars simply won't appear — the grid still works standalone.

### 3. Build & Run

```bash
cd UsageWidget
open UsageWidget.xcodeproj
# Build and Run (Cmd+R) in Xcode
```

Or from the command line:

```bash
cd UsageWidget
xcodebuild -scheme UsageWidget -configuration Release build
open ~/Library/Developer/Xcode/DerivedData/UsageWidget-*/Build/Products/Release/UsageWidget.app
```

### 4. Launch at Login (Optional)

Add `UsageWidget.app` to **System Settings > General > Login Items** to start it automatically.

## Usage

The widget is entirely hover-driven — no labels clutter the display.

| Element | What it shows | On hover |
|---------|--------------|----------|
| Grid cell | Daily activity intensity (darker = less, brighter = more) | Day name, date, message count |
| White-bordered cell | Today | Same as above |
| Dimmed cells | Future days this week | Day name, date |
| Left bar | 5-hour rolling API utilization | Percentage + time until reset |
| Right bar | 7-day rolling API utilization | Percentage + time until reset |

### Color Scale (Grid)

| Color | Messages |
|-------|----------|
| Dark (#1D1816) | 0 |
| Dim (#4A2A1A) | 1-50 |
| Medium (#8B4A25) | 51-300 |
| Bright (#C15F3C) | 301-1000 |
| Brightest (#DA7756) | 1000+ |

### Bar Colors

| Color | Utilization |
|-------|------------|
| Orange (#DA7756) | 0-49% |
| Yellow (#E8A84C) | 50-74% |
| Deep orange (#E07030) | 75-89% |
| Red (#CC3333) | 90%+ |

## Architecture

```
UsageWidget/
├── App/
│   ├── AppDelegate.swift      # Window panel, menu bar, position persistence
│   └── UsageWidgetApp.swift   # App entry point
├── Models/
│   ├── ContributionDay.swift  # Day data model + intensity levels
│   └── StatsCache.swift       # JSON decode for stats-cache.json
├── ViewModels/
│   └── StatsViewModel.swift   # Data loading, grid building, API polling
├── Views/
│   ├── ContentView.swift      # Root layout (grid + bars)
│   ├── ContributionGraphView.swift  # Grid of cells
│   ├── ContributionCellView.swift   # Individual cell with hover
│   └── UsageLimitBarView.swift      # Vertical rate limit bars
└── Utilities/
    ├── FileWatcher.swift      # DispatchSource file monitor
    ├── LiveStatsComputer.swift # Parses JSONL conversation logs
    └── UsageAPIClient.swift   # Anthropic API usage endpoint
```
